"use strict";!function(a){function b(a){a.$menu.show(),a.$menuExpandedClassTarget.addClass(a.menuExpandedClass),a.$menuToggle.attr({"aria-expanded":"true"}),a.$wrapper.addClass("opened").parent().css("overflow-x","hidden"),a.$wrapper.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(b){a.$menu.addClass("opened"),a.$wrapper.addClass("opened")})}function c(a,b){a.$menuExpandedClassTarget.removeClass(a.menuExpandedClass),a.$menuToggle.attr({"aria-expanded":"false"}),a.$overlay.removeAttr("style"),a.$wrapper.on("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(b){a.$menu.removeAttr("style").removeClass("opened"),a.$wrapper.removeClass("opened")})}function d(a,d){var e=a.$menuExpandedClassTarget.hasClass(a.menuExpandedClass)?"opened":"closed";"closed"===e&&b(a),"opened"===e&&c(a,d)}a.OffCanvasMenuController=function(a){if(a=a||{},this.$menu=a.$menu,this.position=a.position||"left",this.menuExpandedClass=a.menuExpandedClass||"show-"+this.position+"-menu",0!=this.$menu.length){if(this.$menuToggle=a.$menuToggle||[],this.$wrapper=a.wrapper||this.$menu.parent(),this.wrapper=this.$wrapper[0],this.$menuExpandedClassTarget=a.$menuExpandedClassTarget||this.$wrapper,this.expandedWidth=this.$menu.outerWidth(),this.ariaControls=a.ariaControls||this.$menu.selector.replace("#",""),this.offCanvasOverlay=a.offCanvasOverlay||"off-canvas-overlay",this.$offCanvasOverlay=$("."+this.offCanvasOverlay),this.$offCanvasOverlay.length||this.$wrapper.append('<div class="'+this.offCanvasOverlay+'"></div>'),this.$overlay=this.$offCanvasOverlay,this.overlay=this.$overlay[0],this.overlayOpacity=a.overlayOpacity||"0.75",this.transitionDuration=1e3*this.$wrapper.css("transition-duration").replace("s",""),this.$menuToggle.length){var b=this;this.$menuToggle.attr({role:"button","aria-controls":b.ariaControls,"aria-expanded":"false"}),this.$menuToggle.click(function(a){a.stopPropagation(),d(b,b.transitionDuration)}),this.$wrapper.click(function(a){b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.stopPropagation(),c(b,b.transitionDuration))}),this.$menu.click(function(a){a.stopPropagation()}),"left"===this.position&&(this.$menu.find("li:first-child a").bind("keydown",function(a){9===a.keyCode&&a.shiftKey&&b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.preventDefault(),b.$menuToggle.focus())}),this.$menuToggle.bind("keydown",function(a){9===a.keyCode&&!a.shiftKey&&b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.preventDefault(),b.$menu.find("li:first-child a").focus())})),"right"===this.position&&(this.$menuToggle.bind("keydown",function(a){9===a.keyCode&&a.shiftKey&&b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.preventDefault(),b.$menu.find("li:last-child a").focus())}),this.$menu.find("li:last-child a").bind("keydown",function(a){9===a.keyCode&&!a.shiftKey&&b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.preventDefault(),b.$menuToggle.focus())})),$(document).bind("keydown",function(a){27===a.keyCode&&b.$menuExpandedClassTarget.hasClass(b.menuExpandedClass)&&(a.stopPropagation(),c(b,b.transitionDuration),b.$menuToggle.focus())})}this.wrapper.addEventListener&&(this.wrapper.addEventListener("touchstart",this,!1),this.wrapper.addEventListener("touchmove",this,!1),this.wrapper.addEventListener("touchend",this,!1),this.wrapper.addEventListener("touchcancel",this,!1))}},a.OffCanvasMenuController.prototype={start:null,handleEvent:function(a){switch(a.type){case"touchstart":this.onTouchStart(a);break;case"touchmove":this.onTouchMove(a);break;case"touchcancel":case"touchend":this.onTouchEnd(a)}},currentPosition:function(){return"left"==this.position?this.$menu.offset().left+this.expandedWidth:this.$menu.offset().left},inBounds:function(a){return"left"==this.position&&a>=-25&&a<=this.expandedWidth||"right"==this.position&&a>=-this.expandedWidth&&25>=a},onTouchStart:function(a){if(this.$menuExpandedClassTarget.hasClass(this.menuExpandedClass)){var b=a.touches[0].pageX;this.start={startingX:this.currentPosition(),pageX:b,pageY:a.touches[0].pageY},this.deltaX=this.$wrapper.position().left,this.isScrolling=void 0,this.wrapper.style.MozTransitionDuration=this.wrapper.style.webkitTransitionDuration=0,a.stopPropagation()}},onTouchMove:function(b){if(this.deltaX=b.touches[0].pageX-this.start.pageX,"undefined"==typeof this.isScrolling&&(this.isScrolling=!!(this.isScrolling||Math.abs(this.deltaX)<Math.abs(b.touches[0].pageY-this.start.pageY))),!this.isScrolling){b.preventDefault();var c="left"==this.position?this.start.startingX+this.deltaX:this.deltaX-($(a).width()-this.start.startingX),d=this.overlayOpacity/this.expandedWidth*Math.abs(c);if($("#test").html(c+" "+Math.abs(c)+" "+this.position+" "+this.expandedWidth),!this.inBounds(c))return;this.wrapper.style.MozTransform=this.wrapper.style.webkitTransform="translate("+c+"px,0)",this.overlay.style.opacity=d,b.stopPropagation()}},onTouchEnd:function(d){if(this.start){var e="left"==this.position?this.start.startingX+this.deltaX:this.deltaX-($(a).width()-this.start.startingX),f=Math.abs(e);this.isScrolling||(this.$wrapper.removeAttr("style"),"left"==this.position&&(f<=.66*this.expandedWidth||0>=e)||"right"==this.position&&(f<=.66*this.expandedWidth||e>=0)?c(this,this.transitionDuration):(b(this),this.$overlay.removeAttr("style"))),this.start=null,d.stopPropagation()}}}}(window);